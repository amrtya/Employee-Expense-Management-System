# Employee Expense Management System | Backend Docs
#### Backend: Spring Boot
#### Database: MySQL

## Database Documentation

### Models:

#### UserModel:
- **`userId`**: String, Autogenerated UUID
- **`email`**: String -> Unique for all Uers
- **`username`**: String
- **`mobileNumber`**: String
- **`active`**: boolean
- **`role`**: String -> USER | MANAGER | ADMIN

    `UserModel` is the table which stores the data for all the users. 
    - `email` should be unique for all users. 
    - `active` is the paramter which decides whether the user is suspended from the platform or not. 
    - `role` is the role of the user in the platform. `role` can take only `USER | MANAGER | ADMIN` values.
    
#### LoginModel:
- **`loginId`**: String, Autogenerated UUID
- **`email`**: String 
- **`password`**: String

    `LoginModel` is the table responsible for holding the `password` for an user corresponding to his/her `email`.
    
#### ExpenseModel:
- **`expenseId`**: String, Autogenerated UUID
- **`billnumber`**: Long
- **`billCost`**: Integer
- **`receiptImage`**: String
- **`datedOn`**: LocalDate
- **`status`**: String -> REIMBURSED | NOT_REIMBURSED
- **`remark`**: String
- **`claimedBy`**: UserModel (referenced column `userId`)
    
    `ExpenseModel` is the table which holds all the individual expenses of an Employee.
    - `receiptImage` is the image of the expense receipt stored in Base64 encoded string.
    - `datedOn` date on which the user has made that expense.
    - `status` is the condition of the expense (whether it is reimbursed or not). It stores 2 values: `REIMBURSED | NOT_REIMBURSED`
    - `remark` is the description of the expense. It might contain relevant description about the expense.
    - `claimedBy` is the User who has made the expense.
    
## API Documentation

#### Users:
- **`USER`**: Employees of the company who will be using this Expense Management System
- **`MANAGER`**: Managers of the company who are responsible for reimbursing the expenses made by the companies.
- **`ADMIN`**: Admins of the company who will be responsible for managing all the users.

### API Endpoints Summary:

#### All:
- **Login**: POST /login

#### USER:
- **Signup**: POST /signup
- **Dashboard**: GET /expense/dashboard/{month}
- **All Expense**: GET /expense
- **Expense Details**: GET /expense/{expense_id}
- **Add Expense**: POST /expense
- **Update Expense**: PUT /expense/{expense_id}
- **Upload Receipt Image**: POST /expense/upload/{expense_id}

#### MANAGER:
- **Get All Expenses**: GET /manager
- **Get Expense**: GET /manager/expense/{expense_id}
- **Update Expense**: PUT /manager/expense/{expense_id}
- **Upload Receipt Image**: POST /manager/expense/upload/{expense_id}
- **Delete Expense**: DELETE /manager/expense/{expense_id}

#### ADMIN:
- **Get All Users**: GET /admin
- **Get User**: GET /admin/{user_id}
- **Add User**: POST /admin/user
- **Update User**: PUT /admin/user/{user_id}
- **Delete User**: DELETE /admin/user/{user_id}

### API Endpoints Detailed Description

#### Response Description
Every Response body has two parmanent fields: `responseType` and `message`. Every response has two optional fields: `result` or `results` based on request.

##### Response Parameters:
- **`responseType`**: `SUCCESS` | `FAILURE` | `EMAIL_TAKEN` | `ROLE_CHANGED` | `INACTIVE`
- **`message`**: Contains the message based on the `responseType`
- **`result`** (optional): Json Object containing the requested information
- **`results`** (optional): Json Array containing the requested information

    **Response Type Description**:
    - `SUCCESS` : The request was successful.
    - `FAILURE` : The request did not succeed.
    - `EMAIL_TAKEN` : This response is received when the `email` of the user has already been taken. Returned in endpoints which involves Addition or Updation of User email.
    - `ROLE_CHANGED` : This response is received when the role of the user has been changed from the `ADMIN` side.
    - `INACTIVE` : This response is received when the user account has been suspended by the `ADMIN`.
    
    
 **All of the Responses are of STATUS CODE 200. However, if some error occurs in the server, responses of other STATUS CODES will be received which do not match the response parameters described above.**
 
#### API Endpoints:

#### All:

- **`Login`**: POST /login
    
    **Description**: Endpoint to login to the System. 
    
    **Request Body**:
    ```json
    {
        "email": "sample@mail.com",
        "password": "password"
    }

    ```
    
    **Response**:
    ```json
    {
        "responseType": "SUCCESS | FAILURE",
        "message": "some message based on response",
        "result": {
                "userId": "4eedc063-ad43-4973-8ddc-d17974f3a36e",
                "email": "some@mail.com",
                "username": "someusername",
                "mobileNumber": "6466666546",
                "active": true,
                "role": "USER | MANAGER | ADMIN"
         }

     }
    ```
    
    
#### USER:

- **`Signup`**: POST /signup

    **Description**: Endpoint to signup to the system. It is recemmended to always signup an user as an USER. Then the ADMIN can change the role of this user as required. If the response is `SUCCESS`, he is registered. `EMAIL_TAKEN` occurs when the email provided by the user is already being used in some other account. 

    **Request Body**:
    ```json
    {
        "email": "some@mail.com",
        "password": "password",
        "username": "someusername",
        "mobileNumber": 6466666546,
        "active": true,
        "role": "USER | MANAGER | ADMIN"
    }

    ```
    
    **Response**:
    ```json
    {
        "responseType": "SUCCESS | EMAIL_TAKEN",
        "message": "message related to response",
        "result": {
            "userId": "4eedc063-ad43-4973-8ddc-d17974f3a36e",
            "email": "some@mail.com",
            "username": "someusername",
            "mobileNumber": "6466666546",
            "active": true,
            "role": "USER | MANAGER | ADMIN"
        }
    }
    ```

- **`Dashboard`**: GET /expense/dashboard/{month}
    
    **Description**: Endpoint to display the dashboard of the USER by month. 
    
    month = `JANUARY` | `FEBRUARY` | `MARCH` | `APRIL` | `MAY` | `JUNE` | `JULY` | `AUGUST` | `SEPTEMBER` | `OCTOBER` | `NOVEMBER` | `DECEMBER`
    
    **Header**:
    user_id={user_id}

    **Request Body**: Not Required
    
    **Response**:

    ```json
    {
        "responseType": "SUCCESS | FAILURE | ROLE_CHANGED | INACTIVE",
        "message": "",
        "result": {
            "totalExpense": 2125,
            "pendingExpense": 2000,
            "approvedExpense": 125,
            "numberExpenses": 2,
            "month": "DECEMBER"
        }
    }
    ```

- **`All Expense`**: GET /expense
    
    **Description**: Endpoint to get All the expenses of a particular user.
    
    **Header**:
    user_id={user_id}

    **Request Body**: Not Required
    
    **Response**:
    
    ```json
    {
        "responseType": "SUCCESS | FAILURE | ROLE_CHANGED | INACTIVE",
        "message": "message related to response",
        "results": 
         [
                {
                "expenseId": "4c2c62da-ba8f-4c93-a03b-8d5173ce2293",
                "billNumber": 3543543,
                "billCost": 125,
                "receiptImage": "base64Encoded Image",
                "datedOn": "1997-12-15",
                "status": "REIMBURSED | NOT_REIMBURSED",
                "remark": "something",
                "claimedBy": {
                    "userId": "4eedc063-ad43-4973-8ddc-d17974f3a36e",
                    "email": "rajtilakls@gmail.com",
                    "password": "password",
                    "username": "rajtilak",
                    "mobileNumber": "86913313",
                    "active": true,
                    "role": "USER | MANAGER | ADMIN"
                }
            },
            .....
        ]
    }
    ```
    
- **`Expense Details`**: GET /expense/{expense_id}

    **Description**: Endpoint to get the Details of a single expense by its ID.
    
    **Header**:
    user_id={user_id}
    
    **Request Body**: Not Required
    
    **Response**:
    
    ```json
    {
        "responseType": "SUCCESS | FAILURE | ROLE_CHANGED | INACTIVE",
        "message": "",
        "result": {
            "expenseId": "9c6ac210-9a59-4e58-ae6d-597d480c564f",
            "billNumber": 98744,
            "billCost": 125,
            "receiptImage": "base64Encoded Image",
            "datedOn": "2000-12-15",
            "status": "REIMBURSED | NOT_REIMBURSED",
            "remark": "of course",
            "claimedBy": {
                "userId": "4eedc063-ad43-4973-8ddc-d17974f3a36e",
                "email": "rajtilakls@gmail.com",
                "password": "password",
                "username": "rajtilak",
                "mobileNumber": "86913313",
                "active": true,
                "role": "USER | MANAGER | ADMIN"
            }
        }
    }
    ```
    
- **`Add Expense`**: POST /expense

    **Description**: Endpoint to add a particular expense. The status of this expense should always be `NOT_REIMBURSED`. If the addition was successful, the expense object is returned back. It addition was a failure, null is returned in the `result` object.
    
    **Header**:
    user_id={user_id}

    **Request Body**:
    ```json
    {
        "billNumber": 98744,
        "billCost": 125,
        "datedOn": "2000-12-15",
        "status": "REIMBURSED | NOT_REIMBURSED",
        "remark": "of course"
    }
    ```

    **Response**:
    
    ```json
    {
        "responseType": "SUCCESS | FAILURE | ROLE_CHANGED | INACTIVE" ,
        "message": "Expense Added",
        "result": {
            "expenseId": "b5382ce7-e192-4d41-8425-ba127883319f",
            "billNumber": 478454,
            "billCost": 2000,
            "receiptImage": "base64Encoded Image",
            "datedOn": "2000-12-15",
            "status": "REIMBURSED | NOT_REIMBURSED",
            "remark": "of course",
            "claimedBy": {
                "userId": "cadf81fe-c41e-419b-8b34-470afc180d80",
                "email": "rajtilak@mail.com",
                "username": "rajtilak",
                "mobileNumber": "6466666546",
                "active": true,
                "role": "USER | MANAGER | ADMIN"
            }
        }

    }
    ```

- **`Update Expense`**: PUT /expense/{expense_id}

    **Description**: Endpoint to update a particular expense. An USER should not be allowed to REIMBURSE an expense. ***The BillCost for an already `REIMBURSED` expense cannot be updated***. On successful updation, the user gets back the Updated Expense Object. If the updation was a failure, null is returned in the `result` parameter.
    
    **Header**:
    user_id={user_id}

    **Request Body**:
    ```json
    {
        "billNumber": 123456,
        "billCost": 356,
        "datedOn": "1998-09-03",
        "status": "NOT_REIMBURSED | REIMBURSED",
        "remark": "still nothing"
    }
    ```
    
    **Response**:
    
    ```json
    {
        "responseType": "SUCCESS | FAILURE | ROLE_CHANGED | INACTIVE",
        "message": "Expense Updated Successfully",
        "result": {
            "expenseId": "4c2c62da-ba8f-4c93-a03b-8d5173ce2293",
            "billNumber": 123456,
            "billCost": 356,
            "receiptImage": "base64Encoded Image",
            "datedOn": "1998-09-03",
            "status": "NOT_REIMBURSED | REIMBURSED",
            "remark": "still nothing",
            "claimedBy": {
                "userId": "4eedc063-ad43-4973-8ddc-d17974f3a36e",
                "email": "rajtilakls@gmail.com",
                "password": "password",
                "username": "rajtilak",
                "mobileNumber": "86913313",
                "active": true,
                "role": "USER | MANAGER | ADMIN"
            }
        }
    }
    ```

- **`Upload Receipt Image`**: POST /expense/upload/{expense_id}

    **Description**: Endpoint to upload the Receipt image of a particular expense. If an image was already uploaded for an expense, it will get updated. The Image is converted to **Base64 String** and stored in the expense object itself.
    
    **Header**:
    user_id={user_id}
    
    **Request Body** (FormData):
```json
{
    "receipt_image": {image_file}
}    
```
    
    **Response**:
    ```json
    {
        "responseType": "SUCCESS | FAILURE | ROLE_CHANGED | INACTIVE",
        "message": "Receipt Image Uploaded Successfully or Failure message"
    }
    ```
    
#### MANAGER:

- **`Get All Expenses`**: GET /manager

    **Description**: Endpoint to get all the expenses present in the system.
    
    **Header**:
    manager_id={manager_id}

    **Request Body**: Not Required
    
    **Response**:
    
    ```json
    {
        "responseType": "SUCCESS | FAILURE | ROLE_CHANGED | INACTIVE",
        "message": "",
        "results": [
            {
                "expenseId": "9c6ac210-9a59-4e58-ae6d-597d480c564f",
                "billNumber": 98744,
                "billCost": 125,
                "receiptImage": "base64Encoded Image",
                "datedOn": "2000-12-15",
                "status": "REIMBURSED | NOT_REIMBURSED",
                "remark": "of course",
                "claimedBy": {
                    "userId": "4eedc063-ad43-4973-8ddc-d17974f3a36e",
                    "email": "rajtilakls@gmail.com",
                    "password": "password",
                    "username": "rajtilak",
                    "mobileNumber": "86913313",
                    "active": true,
                    "role": "USER | MANAGER | ADMIN"
                 }
            },
            ....
        ]
    }
    ```
    
- **`Get Expense`**: GET /manager/expense/{expense_id}

    **Description**: Endpoint to get the details of a particular expense.
    
    **Header**:
    manager_id={manager_id}

    **Request Body**: Not Required
    
    **Response**:
    
    ```json
    {
        "responseType": "SUCCESS | FAILURE | ROLE_CHANGED | INACTIVE",
        "message": "",
        "result": {
            "expenseId": "f4b6aefb-f166-4d6b-9366-70c2ecea00f6",
            "billNumber": 98744,
            "billCost": 125,
            "receiptImage": "base64Encoded Image",
            "datedOn": "2000-12-15",
            "status": "REIMBURSED | NOT_REIMBURSED",
            "remark": "of course",
            "claimedBy": {
                "userId": "4eedc063-ad43-4973-8ddc-d17974f3a36e",
                "email": "maria@gmail.com",
                "password": "password",
                "username": "maria",
                "mobileNumber": "86913313",
                "active": true,
                "role": "USER | MANAGER | ADMIN"
            }
        }
    }
    ```
    
- **`Update Expense`**: PUT /manager/expense/{expense_id}

    **Description**: Endpoint to update the details of a particular expense. On successful updation, the manager gets back the Updated Expense Object. If the updation was a failure, null is returned in the `result` parameter.
    
    **Header**:
    manager_id={manager_id}

    **Request Body**: 
    
    ```json
    {
        "billNumber": 123456,
        "billCost": 356,
        "datedOn": "1998-09-03",
        "status": "NOT_REIMBURSED | REIMBURSED",
        "remark": "still nothing"
    }
    ```
    
    **Response**:
    
    ```json
    {
        "responseType": "SUCCESS | FAILURE | ROLE_CHANGED | INACTIVE",
        "message": "Expense Updated Successfully",
        "result": {
            "expenseId": "9c6ac210-9a59-4e58-ae6d-597d480c564f",
            "billNumber": 123456,
            "billCost": 356,
            "receiptImage": "base64Encoded Image",
            "datedOn": "1998-09-03",
            "status": "NOT_REIMBURSED | REIMBURSED",
            "remark": "still nothing",
            "claimedBy": {
                "userId": "4eedc063-ad43-4973-8ddc-d17974f3a36e",
                "email": "rajtilakls@gmail.com",
                "password": "password",
                "username": "rajtilak",
                "mobileNumber": "86913313",
                "active": true,
                "role": "USER | MANAGER | ADMIN"
            }
        }
    }
    ```

- **`Upload Receipt Image`**: POST /manager/expense/upload/{expense_id}

    **Description**: Endpoint to upload the Receipt image of a particular expense. If an image was already uploaded for an expense, it will get updated. The Image is converted to **Base64 String** and stored in the expense object itself.
    
    **Header**:
    manager_id={manager_id}
    
    **Request Body** (FormData):
    
    ```json
    {
        "receipt_image": {image_file}  
    }  
    ```
    
    **Response**:
    
    ```json
    {
        "responseType": "SUCCESS | FAILURE | ROLE_CHANGED | INACTIVE",
        "message": "Receipt Image Uploaded Successfully or Failure message"
    }
    ```

- **`Delete Expense`**: DELETE /manager/expense/{expense_id}

    **Description**: Endpoint to delete an expense.
    
    **Header**:
    manager_id={manager_id}
    
    **Request Body**: Not Required
    
    **Response**:
    
    ```json
    
        "responseType": "SUCCESS | FAILURE | ROLE_CHANGED | INACTIVE",
        "message": "Deleted Successfully or failure"
    }
    ```
    
#### ADMIN:

- **`Get All Users`**: GET /admin

    **Description**: Endpoint to get all the users in the platform
    
    **Header**:
    admin_id={admin_id}
       
    **Request Body**: Not required
    
    **Response**:
    
    ```json
    {
        "responseType": "SUCCESS | FAILURE | ROLE_CHANGED | INACTIVE",
        "message": "",
        "results": [
           {
                "userId": "4eedc063-ad43-4973-8ddc-d17974f3a36e",
                "email": "maria@gmail.com",
                "password": "password",
                "username": "maria",
                "mobileNumber": "86913313",
                "active": true,
                "role": "USER | MANAGER | ADMIN"
            },
          ...
        ]
    }
    ```
    
- **`Get User`**: GET /admin/{user_id}

    **Description**: Endpoint to get the details of a particular user.
    
    **Header**:
    admin_id={admin_id}

    **Request Body**: Not Required
    
    **Response**:
    
    ```json
    {
        "responseType":  "SUCCESS | FAILURE | ROLE_CHANGED | INACTIVE",
        "message": "",
        "result": {
            "userId": "3343ad80-0ee8-403d-9417-627a2c516e29",
            "email": "rajtilak@mail.com",
            "password": "password",
            "username": "rajtilak",
            "mobileNumber": "6466666546",
            "active": true,
            "role": "USER | MANAGER | ADMIN"
        }
    }
    ```

- **`Add User`**: POST /admin/user

    **Description**: Endpoint to add an user to the system. There are two ways to add users in the system. First, if the user signs up. Second, the admin adds him. If the admins add him, then the admins can add him as an `USER` | `MANAGER` | `ADMIN`.
    
    **Header**:
    admin_id={admin_id}
    
    **Request Body**:
    ```json
    {
        "email": "rajtilak@mail.com",
        "password": "password123",
        "username": "rajtilak",
        "mobileNumber": 6466666546,
        "active": true,
        "role": "USER | MANAGER | ADMIN"
    }
    ```
    
    **Response**:
    ```json
    {
        "responseType": "SUCCESS | FAILURE | ROLE_CHANGED | EMAIL_TAKEN | INACTIVE",
        "message": "User Added Successfully",
        "result": {
            "userId": "cadf81fe-c41e-419b-8b34-470afc180d80",
            "email": "rajtilak@mail.com",
            "username": "rajtilak",
            "mobileNumber": "6466666546",
            "active": true,
            "role": "USER | MANAGER | ADMIN"
        }
    }
    ```

- **`Update User`**: PUT /admin/user/{user_id}

    **Description**: Endpoint to update the details of a user. Using this endpoint, the admin can change the `role` and the account `status` of an user.
    
    **Header**:
    admin_id={admin_id}

    **Request Body**:
    ```json
    {
        "email": "some@mail.com",
        "password": "someotherpassword",
        "username": "someguy",
        "mobileNumber": 123456,
        "active": true,
        "role": "MANAGER | USER | ADMIN"
    }
    ```
    
    **Response**:
    ```json
    {
        "responseType": "SUCCESS | FAILURE | ROLE_CHANGED | EMAIL_TAKEN | INACTIVE",
        "message": "User Updated Successfully or failure",
        "result": {
            "userId": "4eedc063-ad43-4973-8ddc-d17974f3a36e",
            "email": "some@mail.com",
            "username": "someguy",
            "mobileNumber": "123456",
            "active": true,
            "role": "MANAGER | USER | ADMIN"
        }
    }
    ```
    
- **`Delete User`**: DELETE /admin/user/{user_id}
    
    **Description**: Endpoint to delete an user. ***This will delete the user's details and all the expense related to this user.***
    
    **Header**:
    admin_id={admin_id}

    **Request Body**: Not Required
    
    **Response**:
    ```json
    {
        "responseType": "SUCCESS | FAILURE | ROLE_CHANGED | INACTIVE",
        "message": "Deleted Successfully"
    }
    ```
    
